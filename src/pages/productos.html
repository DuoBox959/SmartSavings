<!DOCTYPE html>
<html lang="es">
<head>
  <!-- üîß META Y T√çTULO -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gesti√≥n de Productos</title>
  <meta name="theme-color" content="#ffffff" />

  <!-- üé® ESTILOS (header/footer/nav y p√°gina) -->
  <link rel="stylesheet" href="../style/global/header.css" />
  <link rel="stylesheet" href="../style/producto.css" />
  <link rel="stylesheet" href="../style/global/footer.css" />
  <link rel="stylesheet" href="../style/global/nav.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>

<body>
  <!-- üö´ AVISO SIN JS -->
  <noscript>Para usar esta p√°gina necesitas habilitar JavaScript.</noscript>

  <!-- üß© HEADER (inyectado por JS) -->
  <div id="header"></div>

  <!-- üõ†Ô∏è ACCIONES SUPERIORES -->
  <section class="acciones-superiores">
    <strong></strong>
    <button class="btn-agregar" id="btn-agregar-producto" aria-controls="modal-agregar">Agregar Producto</button>
  </section>

  <!-- üß± LISTADO DE PRODUCTOS -->
  <section id="productos-container" class="productos-container" aria-label="Lista de productos disponibles" aria-live="polite"></section>

  <!-- ‚Ü©Ô∏è BOT√ìN VOLVER -->
  <div class="volver-atras">
    <button class="back-button" id="btn-volver-atras">Volver Atr√°s</button>
  </div>

  <!-- ‚ûï MODAL: AGREGAR PRODUCTO -->
  <div id="modal-agregar" class="modal" role="dialog" aria-modal="true" aria-labelledby="add-title" aria-hidden="true">
    <div class="modal-content">
      <span class="close" id="btn-cerrar-agregar" aria-label="Cerrar">&times;</span>
      <h2 id="add-title">Agregar Producto</h2>

      <!-- Formulario de alta -->
      <form id="form-agregar-producto">
        <label for="add-nombre">Nombre del producto: *</label>
        <input type="text" id="add-nombre" required />

        <label for="add-tipo-select">Tipo del producto: *</label>
        <div class="campo-compuesto">
          <select id="add-tipo-select">
            <option value="">Selecciona un tipo</option>
            <option value="nuevo">Otro (escribir nuevo)</option>
          </select>
          <input type="text" id="add-tipo-nuevo" class="nuevo-campo" placeholder="Nuevo tipo" />
        </div>

        <label for="add-precio">Precio actual (‚Ç¨): *</label>
        <input type="number" id="add-precio" step="0.01" min="0" inputmode="decimal" required />

        <label for="add-peso">Peso: *</label>
        <input type="number" id="add-peso" step="0.01" min="0" inputmode="decimal" required />

        <label for="add-unidadPeso">Unidad de Peso: *</label>
        <select id="add-unidadPeso" required>
          <option value="kg">Kilogramos (kg)</option>
          <option value="g">Gramos (g)</option>
          <option value="l">Litros (l)</option>
          <option value="ml">Mililitros (ml)</option>
        </select>

        <label for="add-supermercado-select">Supermercado: *</label>
        <div class="campo-compuesto">
          <select id="add-supermercado-select" required>
            <option value="">Selecciona un supermercado</option>
            <option value="nuevo">Otro (escribir nuevo)</option>
          </select>
          <input type="text" id="add-supermercado-nuevo" class="nuevo-campo" placeholder="Nuevo supermercado" />
        </div>

        <label for="add-estado">Estado: *</label>
        <select id="add-estado" required>
          <option value="En stock">En stock</option>
          <option value="Sin stock">Sin stock</option>
        </select>

        <!-- üîΩ CAMPOS EXPANDIBLES (opcionales) -->
        <details>
          <summary>Ver m√°s campos para tu producto</summary>

          <!-- Imagen + ayuda para quitar fondo -->
          <div class="campo-imagen-transparente">
            <label for="add-imagen">Imagen del producto:</label>
            <input type="file" id="add-imagen" name="Imagen" accept="image/*" />
            <div class="texto-y-boton">
              <small>Si deseas poner el fondo transparente haz clic aqu√≠:</small>
              <a href="../pages/global/rem_fondo.html" target="_blank" rel="noopener noreferrer" class="btn-quitar-fondo">üéØ Click aqu√≠</a>
            </div>
          </div>

          <!-- Ingredientes -->
          <label for="add-ingredientes">Ingredientes (separados por coma):</label>
          <input type="text" id="add-ingredientes" name="ingredientes" placeholder="Ej: az√∫car, agua, gas carb√≥nico" />

          <!-- Marca (desde Productos o nueva) -->
          <label for="add-marca-select">Marca:</label>
          <div class="campo-compuesto">
            <select id="add-marca-select">
              <option value="">Selecciona una marca</option>
              <option value="nuevo">Otra (escribir nueva)</option>
            </select>
            <input type="text" id="add-marca-nuevo" class="nuevo-campo" style="display:none" placeholder="Nueva marca" />
          </div>

          <!-- Utilidad -->
          <label for="add-utilidad">Descripci√≥n del producto (Utilidad):</label>
          <input type="text" id="add-utilidad" name="utilidad" placeholder="Ej. Bebida refrescante y energizante" />

          <!-- Ubicaci√≥n del nuevo supermercado -->
          <div id="selector-ubicacion-dinamico" style="display:none; margin-top:1.5em; grid-column:span 2">
            <fieldset class="fieldset-ubicacion">
              <legend class="legend-ubicacion">üìç Ubicaci√≥n del supermercado</legend>
              <div class="grid-ubicacion">
                <div class="form-row">
                  <label for="add-pais-existente">Pa√≠s:</label>
                  <select id="add-pais-existente"></select>
                  <input type="text" id="add-nuevo-pais" placeholder="Nuevo pa√≠s" style="display:none" />
                </div>
                <div class="form-row">
                  <label for="add-ciudad-existente">Ciudad:</label>
                  <select id="add-ciudad-existente" style="display:none"></select>
                  <input type="text" id="add-nueva-ciudad" placeholder="Nueva ciudad" style="display:none" />
                </div>
                <div class="form-row full-width">
                  <label for="add-ubicacion-existente">Ubicaci√≥n existente:</label>
                  <select id="add-ubicacion-existente" style="display:none"></select>
                  <label for="add-nueva-ubicacion" id="label-add-nueva-ubicacion">Ubicaci√≥n nueva (direcci√≥n o zona):</label>
                  <input type="text" id="add-nueva-ubicacion" placeholder="Ej: Calle Mayor 45" style="display:none" />
                </div>
              </div>
            </fieldset>
          </div>

          <!-- Proveedor -->
          <label for="add-proveedor-select">Proveedor:</label>
          <div class="campo-compuesto">
            <select id="add-proveedor-select">
              <option value="">Selecciona un proveedor</option>
              <option value="nuevo">Otro (escribir nuevo)</option>
            </select>
            <input type="text" id="add-proveedor-nuevo" class="nuevo-campo" placeholder="Nuevo proveedor" />
          </div>

          <!-- Extras de precio/lote -->
          <label for="add-pais-proveedor">Pa√≠s del proveedor:</label>
          <input type="text" id="add-pais-proveedor" />

          <label for="add-subtipo-select">Subtipo:</label>
          <div class="campo-compuesto">
            <select id="add-subtipo-select">
              <option value="">Selecciona un subtipo</option>
              <option value="nuevo">Otro (escribir nuevo)</option>
            </select>
            <input type="text" id="add-subtipo-nuevo" class="nuevo-campo" placeholder="Nuevo subtipo" />
          </div>

          <label for="add-unidadLote">Unidad/Lote:</label>
          <input type="number" id="add-unidadLote" min="0" inputmode="numeric" />

          <label for="add-precioPorUnidad">Precio por unidad/lote (‚Ç¨):</label>
          <input type="number" id="add-precioPorUnidad" step="0.01" min="0" inputmode="decimal" />

          <label for="add-precioHistorico">Precio Hist√≥rico:</label>
          <textarea id="add-precioHistorico" rows="3" placeholder="Ejemplo: 10, 2023, 12, 2024"></textarea>
        </details>

        <!-- Acciones del modal -->
        <button type="button" id="btn-guardar-producto" aria-label="Guardar nuevo producto">Agregar Producto</button>
        <button type="button" class="btn-cerrar" id="btn-cancelar-agregar">Cancelar</button>
      </form>
    </div>
  </div>

  <!-- ‚úèÔ∏è MODAL: EDITAR PRODUCTO -->
  <div id="modal-editar" class="modal" role="dialog" aria-modal="true" aria-labelledby="edit-title" aria-hidden="true">
    <div class="modal-content">
      <span class="close" id="btn-cerrar-editar" aria-label="Cerrar">&times;</span>
      <h2 id="edit-title">Editar Producto</h2>

      <form id="form-editar-producto">
        <label for="edit-nombre">Nombre del producto: *</label>
        <input type="text" id="edit-nombre" required />

        <label for="edit-tipo-select">Tipo del producto: *</label>
        <div class="campo-compuesto">
          <select id="edit-tipo-select">
            <option value="">Selecciona un tipo</option>
            <option value="nuevo">Otro (escribir nuevo)</option>
          </select>
          <input type="text" id="edit-tipo-nuevo" class="nuevo-campo" placeholder="Nuevo tipo" />
        </div>

        <label for="edit-precio">Precio actual (‚Ç¨): *</label>
        <input type="number" id="edit-precio" step="0.01" min="0" inputmode="decimal" required />

        <label for="edit-peso">Peso: *</label>
        <input type="number" id="edit-peso" step="0.01" min="0" inputmode="decimal" required />

        <label for="edit-unidadPeso">Unidad de Peso: *</label>
        <select id="edit-unidadPeso" required>
          <option value="kg">Kilogramos (kg)</option>
          <option value="g">Gramos (g)</option>
          <option value="l">Litros (l)</option>
          <option value="ml">Mililitros (ml)</option>
        </select>

        <label for="edit-supermercado-select">Supermercado:</label>
        <div class="campo-compuesto">
          <select id="edit-supermercado-select" required>
            <option value="">Selecciona un supermercado</option>
            <option value="nuevo">Otro (escribir nuevo)</option>
          </select>
          <input type="text" id="edit-supermercado-nuevo" class="nuevo-campo" placeholder="Nuevo supermercado (Opcional)" />
        </div>

        <!-- Permitir editar el nombre del supermercado -->
        <div class="campo-editar-supermercado">
          <label for="edit-editar-nombre-supermercado">
            <input type="checkbox" id="edit-editar-nombre-supermercado" class="checkbox-editar-nombre" />
            Editar nombre del supermercado
          </label>
          <input type="text" id="edit-nombre-supermercado-actual" class="campo-editar-nombre" style="display:none;" placeholder="Nombre actual del supermercado" />
        </div>

        <label for="edit-estado">Estado: *</label>
        <select id="edit-estado" required>
          <option value="En stock">En stock</option>
          <option value="Sin stock">Sin stock</option>
        </select>

        <!-- Metadatos ocultos -->
        <input type="hidden" id="edit-producto-id" />
        <input type="hidden" id="edit-fecha-subida" />
        <input type="hidden" id="edit-usuario" />
        <input type="hidden" id="edit-fecha-actualizacion" />

        <details>
          <summary>Ver m√°s campos para tu producto</summary>

          <div class="campo-imagen-transparente">
            <label for="edit-imagen">Imagen del producto:</label>
            <input type="file" id="edit-imagen" name="Imagen" accept="image/*" />
            <div class="texto-y-boton">
              <small>Si deseas poner el fondo transparente haz clic aqu√≠:</small>
              <a href="../pages/global/rem_fondo.html" target="_blank" rel="noopener noreferrer" class="btn-quitar-fondo">üéØ Click aqu√≠</a>
            </div>
          </div>

          <label for="edit-ingredientes">Ingredientes (separados por coma):</label>
          <input type="text" id="edit-ingredientes" placeholder="Ej: az√∫car, agua, gas carb√≥nico" />

          <label for="edit-marca-select">Marca:</label>
          <div class="campo-compuesto">
            <select id="edit-marca-select">
              <option value="">Selecciona una marca</option>
              <option value="nuevo">Otra (escribir nueva)</option>
            </select>
            <input type="text" id="edit-marca-nuevo" class="nuevo-campo" placeholder="Nueva marca" />
          </div>

          <label for="edit-utilidad">Descripci√≥n del producto (Utilidad):</label>
          <input type="text" id="edit-utilidad" placeholder="Ej. Bebida refrescante y energizante" />

          <!-- Ubicaciones (edici√≥n) -->
          <label>Ubicaciones del supermercado:</label>
          <div id="ubicaciones-container-add"></div>
          <button type="button" id="btn-agregar-ubicacion">‚ûï A√±adir ubicaci√≥n</button>

          <!-- Proveedor y precio/lote -->
          <label for="edit-proveedor-select">Proveedor:</label>
          <div class="campo-compuesto">
            <select id="edit-proveedor-select">
              <option value="">Selecciona un proveedor</option>
              <option value="nuevo">Otro (escribir nuevo)</option>
            </select>
            <input type="text" id="edit-proveedor-nuevo" class="nuevo-campo" placeholder="Nuevo proveedor" />
          </div>

          <label for="edit-pais-proveedor">Pa√≠s del proveedor:</label>
          <input type="text" id="edit-pais-proveedor" />

          <label for="edit-subtipo-select">Subtipo:</label>
          <div class="campo-compuesto">
            <select id="edit-subtipo-select">
              <option value="">Selecciona un subtipo</option>
              <option value="nuevo">Otro (escribir nuevo)</option>
            </select>
            <input type="text" id="edit-subtipo-nuevo" class="nuevo-campo" placeholder="Nuevo subtipo" />
          </div>

          <label for="edit-unidadLote">Unidad/Lote:</label>
          <input type="number" id="edit-unidadLote" min="0" inputmode="numeric" />

          <label for="edit-precioPorUnidad">Precio por unidad/lote (‚Ç¨):</label>
          <input type="number" id="edit-precioPorUnidad" step="0.01" min="0" inputmode="decimal" />

          <label for="edit-precioHistorico">Precio Hist√≥rico:</label>
          <textarea id="edit-precioHistorico" rows="3" placeholder="Ejemplo: 10, 2023, 12, 2024"></textarea>
        </details>

        <!-- Acciones del modal -->
        <button type="button" id="btn-guardar-cambios" aria-label="Guardar cambios al producto">Guardar Cambios</button>
        <button type="button" class="btn-cerrar" id="btn-cancelar-editar">Cancelar</button>
      </form>
    </div>
  </div>

  <!-- üß© FOOTER (inyectado por JS) -->
  <div id="footer"></div>

  <!-- üìö LIBRER√çAS -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> -->

  <!-- üß† M√ìDULO PRINCIPAL -->
  <script type="module" src="../functions/productos.js"></script>
</body>
</html>
